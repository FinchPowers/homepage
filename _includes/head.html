<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title | escape }} - {{ site.description | escape }}{% endif %}</title>
  <!-- Description generated by SEO Tag
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  -->

  <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}">

  <!-- Fonts -->
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Source+Code+Pro|Libre+Baskerville|Rubik:400,500,700i">
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/assets/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/assets/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/assets/manifest.json">
  <link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#8e6abb">
  <link rel="shortcut icon" href="/assets/favicon.ico">
  <meta name="msapplication-config" content="/assets/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">

  {% seo title=false %}

  {% if jekyll.environment == 'production' and site.google_analytics %}
  {% include google-analytics.html %}
  {% endif %}

  <script type="text/javascript">
  // isAutoplaySupported(callback);
  // Test if HTML5 video autoplay is supported
  </script>

  <script type="text/javascript">
  var canAutoPlay = null;
  var videos = null,
    didScroll = false,
    timer = null,
    fraction = 0.5;

  function removeLoadingClass(el) {
    el.className = el.className.replace(/\bloading\b/g,'');
  }

  function addLoadingClass(el) {
    el.className = el.className + ' loading';
  }

  function addButtonClass(el) {
    el.className = el.className + ' button';
  }

  // Adapted from
  // https://gist.github.com/nathansearles/271870d4100f0f045c5c
  function isAutoplaySupported(realVideo, callback) {
    // Is the callback a function?
    if (typeof callback !== 'function') {
      console.log('isAutoplaySupported: Callback must be a function!');
      return false;
    }
    // Create video element to test autoplay
    var video = document.createElement('video');
    video.autoplay = true;
    video.muted = true;
    video.setAttribute('webkit-playsinline', 'webkit-playsinline');
    video.setAttribute('playsinline', 'playsinline');
    video.src = realVideo.src
    video.load();
    video.style.display = 'none';
    video.playing = false;
    video.play();
    // Check if video plays
    video.onplay = function() {
      this.playing = true;
    };
    // Video has loaded, check autoplay support
    video.oncanplay = function() {
      if (video.playing) {
        callback(true);
      } else {
        callback(false);
      }
    };
  }

  function checkScroll() {
    didScroll = true;
    if (timer === null) {
      timer = window.setInterval(function() {
        if (!didScroll) {
          window.clearInterval(timer);
          timer = null;
          return;
        }
        checkVideos();
        didScroll = false;
      }, 100);
    }
  }

  function checkVideos() {
    var windowHeight  = window.innerHeight;
    var windowWidth   = window.innerWidth;

    videos.map(function(video) {
      var offset = video.getBoundingClientRect();

      var top    = offset.top;
      var left   = offset.left;
      var right  = offset.right;
      var width  = offset.width;
      var height = offset.height;
      var bottom = offset.bottom;

      var visibleX = right <= 0
        ? 0
        : left >= windowWidth
          ? 0
          : left <= 0
            ? Math.min(right, windowWidth)
            : Math.min(width, windowWidth - left);
      var visibleY = bottom <= 0
        ? 0
        : top >= windowHeight
          ? 0
          : top <= 0
            ? Math.min(bottom, windowHeight)
            : Math.min(height, windowHeight - top);

      var visible = visibleX * visibleY / (width * height);

      if (visible > fraction) {
        video.play();
//
//        checkAutoPlay(video);
      } else {
        video.pause();
      }
    });
  }

//  function checkAutoPlay(video) {
//    // Script based on
//    // https://gist.github.com/nathansearles/271870d4100f0f045c5c
//    if (canAutoPlay === null) {
//      canAutoPlay = 'checking';
//      video.onplay = videoPlay(video);
//      video.oncanplay = videoCanPlay(video);
//    }
//  }
//
//  function videoPlay(el) {
//    canAutoPlay = 'playing';
//  }
//
//  function videoCanPlay(el) {
//    if (canAutoPlay === 'playing') {
//      canAutoPlay = true;
//    } else {
//      videos.map(function(video) {
//        var el = video.parentNode;
//
//        removeLoadingClass(el);
//        addButtonClass(el);
//      });
//    }
//  }

  function videoLoadStart(el) {
    addLoadingClass(el.parentNode);
  }

  function videoCanPlayThrough(el) {
    removeLoadingClass(el.parentNode);
  }

  function videoClick(el) {
    if (el.paused) {
      el.play();
    } else {
      el.pause();
    }
  }

  function playClick(el) {
    var parent = el.parentNode;
    var els = parent.getElementsByTagName('video');

    if (els.length === 0) {
      return;
    } else {
      videoClick(els[0]);
      el.style.display = 'none';
    }
  }

  window.onload = function() {
    videos = Array.prototype.slice.call(document.getElementsByTagName("video")),

    checkVideos();

    isAutoplaySupported(videos[0], function(supported) {
      if ( ! supported) {
        videos.map(function(video) {
          var el = video.parentNode;

          removeLoadingClass(el);
          addButtonClass(el);
        });
      }
    });

    window.addEventListener("scroll", checkScroll, false);
    window.addEventListener("resize", checkScroll, false);
  };
  </script>
</head>
